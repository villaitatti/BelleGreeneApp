<div data-flex-layout='row' style="justify-content: center; align-items: center; display: flex; padding-top: 20vh">
    <div class='rs-page__summary' style='width:60%;'>
        <div class='rs-entity-fields'>

            <semantic-query
                query='
                    SELECT DISTINCT ?title ?sender ?recipient ?place ?begin_date ?end_date WHERE { 
                        <[[this]]> crm:P16i_was_used_for ?exchange_activity;
                            crm:P108i_was_produced_by ?production;
                            rdfs:label ?title.

                    ?production crm:P7_took_place_at ?place;
                        crm:P4_has_time-span ?production_time_span.
                    
                    ?production_time_span crm:P82a_begin_of_the_begin ?begin_date;
                        crm:P82b_end_of_the_end ?end_date.

                    ?exchange_activity rdf:type crm:E7_Activity;
                        crm:P01i_is_domain_of ?sender_activity;
                        crm:P01i_is_domain_of ?recipient_activity.

                    ?sender_activity a crm:PC14_carried_out_by;
                        crm:P14.1_in_the_role_of  <https://bellegreene.itatti.harvard.edu/resource/type/Sender>;
                        crm:P02_has_range ?sender.

                    ?recipient_activity a crm:PC14_carried_out_by;
                        crm:P14.1_in_the_role_of  <https://bellegreene.itatti.harvard.edu/resource/type/Recipient>;
                        crm:P02_has_range ?recipient.

                    }'
                template="{{> metadata}}"
            >

            <template id="metadata">

                {{#each bindings}}

                    <div class="workInfoContainer">
                        <div data-flex-layout="row center-left">
                            <h3>{{title.value}}</h3>
                        </div>
                        <div class="rs-page__summary-content table-responsive">

                            <div style="margin-top:18px;margin-left:20px;">
                                <ul>
                                    <li> <strong>Date: </strong> {{begin_date.value}}</li>
                                    <li> <strong>Sender: </strong> <semantic-link iri="{{sender.value}}"></semantic-link></li>
                                    <li> <strong>Recipient: </strong> <semantic-link iri="{{recipient.value}}"></semantic-link></li>
                                    <li> <strong>Written in: </strong> <semantic-link iri="{{place.value}}"></semantic-link></li>
                                    
                                    <!-- People mentioned -->
                                    <semantic-query
                                        query='
                                            SELECT DISTINCT ?person WHERE { 
                                                <[[this]]> crm:P67_refers_to ?person.
                                            }'
                                        template="{{> people}}"
                                    >

                                        <template id="people">
                                        <li> <strong>People mentioned: </strong> 
                                            {{#each bindings}}
                                                <semantic-link iri="{{person.value}}"></semantic-link>;  
                                            {{/each}}
                                        </li>

                                    </semantic-query> 

                                    <!-- subjects -->
                                    <semantic-query
                                        query='
                                            SELECT DISTINCT ?tag WHERE { 
                                                <[[this]]> crm:P129_is_about ?tag.
                                            }'
                                        template="{{> subjects}}"
                                    >
                                        
                                        <template id="subjects">
                                            <li> <strong>Subjects: </strong> 
                                                {{#each bindings}}
                                                    <span class="badge text-bg-secondary"><mp-label iri={{tag.value}}></mp-label> </span> 
                                                {{/each}}
                                            </li>
                                        </template>
                                    </semantic-query>

                                </ul>
                            </div>
                            
                            <semantic-table 
                                style="margin-bottom: 100px;"
                                id='table-result'
                                query='SELECT DISTINCT ?subject ?document ?imageIRI WHERE { 
                                ?page custom:part_of ?subject;
                                    crm:P129i_is_subject_of ?document;
                                    custom:index ?index;
                                    crm:P183i_has_representation ?imageIRI.

                                ?imageIRI crm:P2_has_type custom:thumbnail_img.

                                    BIND(xsd:integer(?index) as ?index_num)
                                } ORDER BY ASC(?index_num)'

                                column-configuration='[
                                {
                                    "displayName": "Text",
                                    "cellTemplate": "{{> text}}"
                                }]'
                                options='{
                                    "showTableHeading": false,
                                    "showFilter": false
                                }'
                                number-of-displayed-rows="10">

                                <template id="text">
                            <rs-text-annotation-workspace
                                storage="belle_greene"
                                document-iri="{{document.value}}"
                                annotation-subject-template="https://belle-greene.com/annotation/{{{{raw}}}}{{UUID}}{{{{/raw}}}}"
                                image-iri="{{imageIRI.value}}"
                                fallback-template="{{> fallback-template}}"
                                annotation-tooltip="{{> annotation-tooltip}}">

                                <template id="fallback-template">
                                    Missing type for annotation <semantic-link iri="{{ iri.value }}"></semantic-link>
                                </template>

                                <template id="annotation-tooltip">
                                <div>
                                    {{#if allowEdit}}
                                    <button
                                    name="edit"
                                    class="btn btn-xs btn-default"
                                    data-annotation="{{ iri.value }}"
                                    title="Edit annotation"
                                    >
                                    <span class="fa fa-pencil" style="pointer-events: none;"></span>
                                    </button>
                                    {{else}}
                                    <button
                                    name="edit"
                                    class="btn btn-xs btn-default"
                                    disabled
                                    title="Edit annotation"
                                    >
                                    <span class="fa fa-pencil" style="pointer-events: none;"></span>
                                    </button>
                                    {{/if}}
                                    {{#if allowDelete}}
                                    <button
                                    name="delete"
                                    class="btn btn-xs btn-default"
                                    data-annotation="{{ iri.value }}"
                                    title="Delete annotation"
                                    >
                                    <span class="fa fa-trash" style="pointer-events: none;"></span>
                                    </button>
                                    {{else}}
                                    <button
                                    name="delete"
                                    class="btn btn-xs btn-default"
                                    disabled
                                    title="Delete annotation"
                                    >
                                    <span class="fa fa-trash" style="pointer-events: none;"></span>
                                    </button>
                                    {{/if}}
                                </div>
                                </template>

                            </rs-text-annotation-workspace>
                            </template>

                            </semantic-table>

                            <div style="margin-top:18px;margin-left:20px;">
                            </div>
                        </div>
                    </div>

                {{/each}}

            </template>



            </semantic-query>

        </div>


    </div>

</div>